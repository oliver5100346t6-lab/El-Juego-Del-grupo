<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>El Juego del Grupo</title>
<style>
body { background:white; margin:0; font-family:Arial,sans-serif; text-align:center; user-select:none; overflow-x:hidden; }
button { border:none; border-radius:10px; transition:0.2s; }
#playButton { margin-top:200px; padding:20px 50px; font-size:30px; background:#007bff; color:white; cursor:pointer; }
#playButton:hover { background:#0056c7; }
#gameArea, #stage2, #stage3 { display:none; margin-top:40px; }
.drag { width:30vw; max-width:150px; height:30vw; max-height:150px; border-radius:10px; cursor:grab; position:relative; margin:2vw; transition:transform 0.2s, opacity 0.2s; }
.drag:active { transform:scale(1.1); opacity:0.8; box-shadow:0 10px 20px rgba(0,0,0,0.3); }
.dropzone { width:32vw; max-width:160px; height:32vw; max-height:160px; border:3px dashed #888; border-radius:10px; display:inline-block; margin:2vw; background-size:cover; background-position:center; }
#continueBtn, #stage2Continue, #stage3Continue { margin-top:5vw; padding:15px 40px; font-size:20px; border-radius:10px; opacity:0.5; cursor:not-allowed; pointer-events:none; }
#stage2Continue, #stage3Continue { background:#28a745; color:white; }
.shake { animation: shake 0.3s; }
@keyframes shake {0%{transform:translateX(0px);}25%{transform:translateX(-10px);}50%{transform:translateX(10px);}75%{transform:translateX(-10px);}100%{transform:translateX(0px);}}
.fade { animation: fadeOut 0.6s forwards; }
@keyframes fadeOut { to{opacity:0; transform:scale(0.5);} }
#stage2Continue,#stage3Continue{display:block;margin:30px auto 0 auto; transform:translateY(50px); opacity:0; transition:all 0.5s;}
</style>
</head>
<body>

<button id="playButton">A JUGAR!</button>

<!-- ETAPA 1 -->
<div id="gameArea">
<h2>Arrastra cada imagen a su pareja correcta</h2>
<div id="dragContainer">
<img src="Chatgpt111.png" class="drag" id="drag1">
<img src="Foto de Yugerson XD.jpg" class="drag" id="drag2">
<img src="IMG_20251028_160719132_BURST001.jpg" class="drag" id="drag3">
</div>
<div id="dropContainer">
<div class="dropzone" id="drop1" data-match="drag2" style="background-image:url('Screenshot_20251029-231241_1.jpg');"></div>
<div class="dropzone" id="drop2" data-match="drag3" style="background-image:url('a47c3705215f5bd024868af6ca9d4999.jpg');"></div>
<div class="dropzone" id="drop3" data-match="drag1" style="background-image:url('chatgpt_22oct2025.png');"></div>
</div>
<button id="continueBtn">ðŸ”’ Continuar</button>
</div>

<!-- ETAPA 2 -->
<div id="stage2">
<h2 style="color:black; font-family:Arial, sans-serif;">Ayuda a Chance a disparar su Pistola!</h2>
<div id="stage2Images" style="display:flex; flex-wrap:wrap; justify-content:center; align-items:center; gap:20px; margin-top:20px;">
<img src="Chance.png" id="chance" style="width:25vw; max-width:150px;">
<img src="Pistola De Chance.png" id="pistola" style="width:20vw; max-width:120px; cursor:pointer; position:relative;">
<img src="Bala De Chance .png" id="bala" style="width:10vw; max-width:60px; cursor:grab; position:relative;">
<img src="1x1x1x1.png" id="enemigo" style="width:25vw; max-width:150px; position:relative;">
</div>
<button id="stage2Continue">Continuar</button>
</div>

<!-- ETAPA 3 -->
<div id="stage3">
<div id="stage3Area" style="
        position:relative; 
        height:50vh; 
        width:90vw; 
        max-width:600px; 
        margin:250px auto 0 auto; 
        background:#f0f0f0; 
        overflow:hidden;
        border-radius:10px;
        touch-action:none;">
  
  <div id="leftLine" style="position:absolute; left:5%; top:0; width:10px; height:100%; background:blue;"></div>
  <div id="rightLine" style="position:absolute; right:5%; top:0; width:10px; height:100%; background:blue;"></div>
  
  <img src="IMG_20251028_160719132_BURST001.jpg" id="melvin" 
       style="position:absolute; left:5%; top:50%; transform:translateY(-50%); width:12vw; max-width:120px; transition:top 0.05s;">
  
  <div id="playerPaddle" 
       style="position:absolute; right:5%; top:50%; width:20px; height:20%; background:blue; transform:translateY(-50%); touch-action:none;"></div>

  <div id="ball" 
       style="position:absolute; width:20px; height:20px; border-radius:50%; background:blue; left:50%; top:50%; transform:translate(-50%, -50%);"></div>
</div>

<button id="stage3Continue" style="margin-top:50px; opacity:0; pointer-events:none;">Continuar</button>
</div>

<script>
// BOTON A JUGAR
const playButton=document.getElementById("playButton");
const gameArea=document.getElementById("gameArea");
playButton.onclick=()=>{playButton.style.display="none"; gameArea.style.display="block";}

// ETAPA 1
let correct=0;
const continueBtn=document.getElementById('continueBtn');
document.querySelectorAll('.drag').forEach(drag=>{
    drag.addEventListener('dragstart', e=> e.dataTransfer.setData('id', drag.id));
    drag.addEventListener('touchstart', e=>{
        drag.classList.add('dragging');
        drag.touchOffsetX=e.touches[0].clientX - drag.getBoundingClientRect().left;
        drag.touchOffsetY=e.touches[0].clientY - drag.getBoundingClientRect().top;
    });
    drag.addEventListener('touchmove', e=>{
        e.preventDefault();
        const t=e.touches[0];
        drag.style.position='absolute';
        drag.style.left=(t.clientX - drag.touchOffsetX)+'px';
        drag.style.top=(t.clientY - drag.touchOffsetY)+'px';
        drag.style.zIndex=1000;
    });
    drag.addEventListener('touchend', e=>{
        drag.classList.remove('dragging');
        let dropped=false;
        document.querySelectorAll('.dropzone').forEach(zone=>{
            const rect=zone.getBoundingClientRect();
            const dragRect=drag.getBoundingClientRect();
            if(dragRect.left + dragRect.width/2 > rect.left && dragRect.left + dragRect.width/2 < rect.right &&
               dragRect.top + dragRect.height/2 > rect.top && dragRect.top + dragRect.height/2 < rect.bottom){
                   handleDrop(zone, drag.id);
                   dropped=true;
            }
        });
        if(!dropped){ drag.style.left=''; drag.style.top=''; drag.style.position=''; drag.style.zIndex=''; }
    });
});
document.querySelectorAll('.dropzone').forEach(zone=>{
    zone.addEventListener('dragover', e=>e.preventDefault());
    zone.addEventListener('drop', e=>{ handleDrop(zone,e.dataTransfer.getData('id')); });
});
function handleDrop(zone,droppedId){
    if(zone.dataset.match===droppedId){
        const elem=document.getElementById(droppedId);
        elem.classList.add('fade');
        setTimeout(()=>elem.style.display='none',600);
        zone.style.border='3px solid #00cc44';
        correct++;
        if(correct===3){ continueBtn.style.opacity=1; continueBtn.style.cursor='pointer'; continueBtn.style.pointerEvents='auto'; continueBtn.innerHTML='Continuar âœ”'; }
    } else { document.body.classList.add('shake'); setTimeout(()=>document.body.classList.remove('shake'),300);}
}
continueBtn.onclick=()=>{ if(correct<3){ document.body.classList.add('shake'); setTimeout(()=>document.body.classList.remove('shake'),300);} else{ gameArea.style.display='none'; showStage2(); }}

// ETAPA 2
const stage2=document.getElementById('stage2');
const bala=document.getElementById('bala');
const pistola=document.getElementById('pistola');
const enemigo=document.getElementById('enemigo');
const stage2Continue=document.getElementById('stage2Continue');
let balaInPistola=false;
function showStage2(){ stage2.style.display='block'; window.scrollTo(0,0);}
bala.addEventListener('touchstart', e=>{
    bala.classList.add('dragging'); 
    bala.touchOffsetX=e.touches[0].clientX-bala.getBoundingClientRect().left;
    bala.touchOffsetY=e.touches[0].clientY-bala.getBoundingClientRect().top;
});
bala.addEventListener('touchmove', e=>{
    e.preventDefault();
    const t=e.touches[0];
    bala.style.position='absolute';
    bala.style.left=(t.clientX-bala.touchOffsetX)+'px';
    bala.style.top=(t.clientY-bala.touchOffsetY)+'px';
    bala.style.zIndex=1000;
});
bala.addEventListener('touchend', e=>{
    const rect=bala.getBoundingClientRect();
    const pistRect=pistola.getBoundingClientRect();
    if(rect.left+rect.width/2>pistRect.left && rect.left+rect.width/2<pistRect.right &&
       rect.top+rect.height/2>pistRect.top && rect.top+rect.height/2<pistRect.bottom){
        bala.style.display='none'; balaInPistola=true; alert('Bala lista para disparar!');
    } else { bala.style.left=''; bala.style.top=''; bala.style.position=''; bala.style.zIndex=''; }
});
pistola.addEventListener('click',()=>{
    if(!balaInPistola) return;
    pistola.style.transition='transform 0.5s'; pistola.style.transform='rotate(360deg)';
    setTimeout(()=>{
        pistola.style.transform='rotate(0deg)';
        if(Math.random()<0.875){ disparoExitoso(); } 
        else { alert('Mala suerte, la pistola no disparÃ³'); bala.style.display='block'; balaInPistola=false; }
    },500);
});
function disparoExitoso(){
    pistola.style.transition='transform 0.1s'; pistola.style.transform='rotate(-10deg)';
    setTimeout(()=>pistola.style.transform='rotate(0deg)',100);
    document.body.classList.add('shake'); setTimeout(()=>document.body.classList.remove('shake'),1000);
    const audio=new Audio('ARGHHH.mp3'); audio.volume=0.5; audio.play();
    enemigo.style.transition='opacity 1s'; enemigo.style.opacity=0;
    pistola.style.pointerEvents='none';
    setTimeout(()=>{ stage2Continue.style.transform='translateY(0)'; stage2Continue.style.opacity=1; stage2Continue.style.pointerEvents='auto'; },1000);
}
stage2Continue.onclick=()=>{ stage2.style.display='none'; showStage3(); }

// ETAPA 3
const stage3Area=document.getElementById('stage3Area');
const stage3Ball=document.getElementById('ball');
const stage3Melvin=document.getElementById('melvin');
const stage3Paddle=document.getElementById('playerPaddle');
const stage3Continue=document.getElementById('stage3Continue');

let ballX=stage3Area.offsetWidth/2, ballY=stage3Area.offsetHeight/2;
let ballSpeedX=2, ballSpeedY=2;
let gameRunning=true;

function movePlayer3(e){
    e.preventDefault();
    let y;
    if(e.touches) y=e.touches[0].clientY - stage3Area.getBoundingClientRect().top - stage3Paddle.offsetHeight/2;
    else y=e.clientY - stage3Area.getBoundingClientRect().top - stage3Paddle.offsetHeight/2;
    if(y<0) y=0;
    if(y>stage3Area.offsetHeight-stage3Paddle.offsetHeight) y=stage3Area.offsetHeight-stage3Paddle.offsetHeight;
    stage3Paddle.style.top=y+'px';
}
document.addEventListener('mousemove', movePlayer3);
document.addEventListener('touchmove', movePlayer3, {passive:false});

function showStage3(){ document.getElementById('stage3').style.display='block'; startGame3(); }
function startGame3(){
    gameRunning=true;
    ballX=stage3Area.offsetWidth/2;
    ballY=stage3Area.offsetHeight/2;
    ballSpeedX=2;
    ballSpeedY=2;
    requestAnimationFrame(gameLoop);
}

function gameLoop(){
    if(!gameRunning) return;
    ballX+=ballSpeedX; ballY+=ballSpeedY;

    if(ballY<=0 || ballY+stage3Ball.offsetHeight>=stage3Area.offsetHeight) ballSpeedY*=-1;

    const paddleRect=stage3Paddle.getBoundingClientRect();
    const ballRect=stage3Ball.getBoundingClientRect();
    const melvinRect=stage3Melvin.getBoundingClientRect();
    const areaRect=stage3Area.getBoundingClientRect();

    // Rebote jugador
    if(ballRect.right>=paddleRect.left && ballRect.bottom>=paddleRect.top && ballRect.top<=paddleRect.bottom){
        ballSpeedX*=-1;
        let impact=(ballY-(paddleRect.top-areaRect.top+stage3Paddle.offsetHeight/2))/stage3Paddle.offsetHeight;
        ballSpeedY=impact*4;
        ballX=paddleRect.left-areaRect.left-stage3Ball.offsetWidth;
    }

    // Rebote Melvin
    if(ballRect.left<=melvinRect.right && ballRect.bottom>=melvinRect.top && ballRect.top<=melvinRect.bottom){
        ballSpeedX*=-1;
        let impact=(ballY-(melvinRect.top-areaRect.top+stage3Melvin.offsetHeight/2))/stage3Melvin.offsetHeight;
        ballSpeedY=impact*4;
        ballX=melvinRect.right-areaRect.left;
    }

    // MELVIN IA PERFECTO
    let predictedY=ballY + ballSpeedY*((melvinRect.right-ballX)/ballSpeedX);
    let targetY=predictedY-stage3Melvin.offsetHeight/2;
    if(targetY<0) targetY=0;
    if(targetY>stage3Area.offsetHeight-stage3Melvin.offsetHeight) targetY=stage3Area.offsetHeight-stage3Melvin.offsetHeight;
    stage3Melvin.style.top=targetY+'px';

    // Si toca tu lado -> reinicia
    if(ballX+stage3Ball.offsetWidth>=stage3Area.offsetWidth){
        gameRunning=false;
        alert('Â¡Melvin ganÃ³! Reinicia la etapa.');
        ballX=stage3Area.offsetWidth/2; ballY=stage3Area.offsetHeight/2;
        startGame3();
    }

    stage3Ball.style.left=ballX+'px';
    stage3Ball.style.top=ballY+'px';

    requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>
