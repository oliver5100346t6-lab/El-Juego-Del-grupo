<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>El Juego del Grupo</title>
<style>
    body {
        background: white;
        margin: 0;
        font-family: Arial, sans-serif;
        text-align: center;
        user-select: none;
        overflow-x: hidden;
    }
    button {
        border: none;
        border-radius: 10px;
        transition: 0.2s;
    }
    #playButton {
        margin-top: 200px;
        padding: 20px 50px;
        font-size: 30px;
        background: #007bff;
        color: white;
        cursor: pointer;
    }
    #playButton:hover { background: #0056c7; }
    #gameArea, #stage2, #stage3 { display: none; margin-top: 40px; }

    .drag {
        width: 30vw; max-width: 150px;
        height: 30vw; max-height: 150px;
        border-radius: 10px;
        cursor: grab;
        position: relative;
        margin: 2vw;
    }
    .dropzone {
        width: 32vw; max-width: 160px;
        height: 32vw; max-height: 160px;
        border: 3px dashed #888;
        border-radius: 10px;
        display: inline-block;
        margin: 2vw;
        background-size: cover;
        background-position: center;
    }
    #continueBtn, #stage2Continue, #stage3Continue {
        margin-top: 5vw;
        padding: 15px 40px;
        font-size: 20px;
        border-radius: 10px;
        opacity: 0.5;
        cursor: not-allowed;
        pointer-events: none;
    }
    #stage2Continue { background:#28a745; }
    #stage3Continue { background:#28a745; }

    .shake { animation: shake 0.3s; }
    @keyframes shake {
        0% { transform: translateX(0px); }
        25% { transform: translateX(-10px); }
        50% { transform: translateX(10px); }
        75% { transform: translateX(-10px); }
        100% { transform: translateX(0px); }
    }
    .fade { animation: fadeOut 0.6s forwards; }
    @keyframes fadeOut { to { opacity: 0; transform: scale(0.5); } }
    #stage2Continue, #stage3Continue { display: block; margin: 30px auto 0 auto; transform: translateY(50px); opacity:0; transition:all 0.5s; }

    /* Etapa 3 */
    #stage3Area { display:flex; justify-content:space-between; align-items:center; margin-top:50px; position:relative; height:50vh; }
    #melvin { width:20vw; max-width:150px; height:auto; }
    #playerPaddle { width:20px; background:blue; position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer; }
    #ball { width:20px; height:20px; border-radius:50%; background:blue; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); }
    #leftLine, #rightLine { width:5px; background:blue; position:absolute; top:0; bottom:0; }
    #leftLine { left:0; } #rightLine { right:0; }
</style>
</head>
<body>

<button id="playButton">A JUGAR!</button>

<!-- ETAPA 1 -->
<div id="gameArea">
    <h2>Arrastra cada imagen a su pareja correcta</h2>
    <div id="dragContainer">
        <img src="Chatgpt111.png" class="drag" draggable="true" id="drag1">
        <img src="Foto de Yugerson XD.jpg" class="drag" draggable="true" id="drag2">
        <img src="IMG_20251028_160719132_BURST001.jpg" class="drag" draggable="true" id="drag3">
    </div>
    <div id="dropContainer">
        <div class="dropzone" id="drop1" data-match="drag2" style="background-image: url('Screenshot_20251029-231241_1.jpg');"></div>
        <div class="dropzone" id="drop2" data-match="drag3" style="background-image: url('a47c3705215f5bd024868af6ca9d4999.jpg');"></div>
        <div class="dropzone" id="drop3" data-match="drag1" style="background-image: url('chatgpt_22oct2025.png');"></div>
    </div>
    <button id="continueBtn">ðŸ”’ Continuar</button>
</div>

<!-- ETAPA 2 -->
<div id="stage2">
    <h2 style="color:black; font-family:Arial, sans-serif;">Ayuda a Chance a disparar su Pistola!</h2>
    <div id="stage2Images" style="display:flex; flex-wrap:wrap; justify-content:center; align-items:center; gap:20px; margin-top:20px;">
        <img src="Chance.png" id="chance" style="width:25vw; max-width:150px;">
        <img src="Pistola De Chance.png" id="pistola" style="width:20vw; max-width:120px; cursor:pointer; position:relative;">
        <img src="Bala De Chance .png" id="bala" style="width:10vw; max-width:60px; cursor:grab; position:relative;">
        <img src="1x1x1x1.png" id="enemigo" style="width:25vw; max-width:150px; position:relative;">
    </div>
    <button id="stage2Continue">Continuar</button>
</div>

<!-- ETAPA 3 -->
<div id="stage3">
    <div id="stage3Area">
        <img src="IMG_20251028_160719132_BURST001.jpg" id="melvin">
        <div id="playerPaddle"></div>
        <div id="leftLine"></div>
        <div id="rightLine"></div>
        <div id="ball"></div>
    </div>
    <button id="stage3Continue">Continuar</button>
</div>

<script>
// BOTON A JUGAR
const playButton = document.getElementById("playButton");
const gameArea = document.getElementById("gameArea");
playButton.onclick = () => { playButton.style.display = "none"; gameArea.style.display = "block"; };

// ETAPA 1 - DRAG & DROP FLUIDO
let correct = 0;
const drags = document.querySelectorAll('.drag');
function makeDraggable(el){
    let offsetX=0, offsetY=0;
    function move(x,y){
        el.style.position='absolute';
        el.style.left=(x-offsetX)+'px';
        el.style.top=(y-offsetY)+'px';
    }
    el.addEventListener('mousedown', e=>{
        offsetX = e.offsetX; offsetY = e.offsetY;
        function mouseMove(e){ move(e.clientX,e.clientY); }
        function mouseUp(){ window.removeEventListener('mousemove', mouseMove); window.removeEventListener('mouseup', mouseUp); }
        window.addEventListener('mousemove', mouseMove); window.addEventListener('mouseup', mouseUp);
    });
    el.addEventListener('touchstart', e=>{ const t=e.touches[0]; offsetX=t.targetTouches[0].clientX - el.getBoundingClientRect().left; offsetY=t.targetTouches[0].clientY - el.getBoundingClientRect().top; });
    el.addEventListener('touchmove', e=>{
        e.preventDefault(); const t=e.touches[0]; move(t.clientX,t.clientY);
    });
}
drags.forEach(makeDraggable);

// Dropzone logic similar al anterior
function handleDrop(zone,droppedId){
    if(zone.dataset.match===droppedId){
        document.getElementById(droppedId).classList.add('fade'); setTimeout(()=>document.getElementById(droppedId).style.display='none',600);
        zone.style.border='3px solid #00cc44'; correct++;
        if(correct===3){
            const btn=document.getElementById('continueBtn'); btn.style.opacity=1; btn.style.cursor='pointer'; btn.style.pointerEvents='auto'; btn.innerHTML='Continuar âœ”';
        }
    } else {
        document.body.classList.add('shake'); setTimeout(()=>document.body.classList.remove('shake'),300);
    }
}
document.getElementById('continueBtn').onclick=()=>{
    if(correct<3){ document.body.classList.add('shake'); setTimeout(()=>document.body.classList.remove('shake'),300); }
    else{ gameArea.style.display='none'; showStage2(); }
};

// ETAPA 2
const stage2 = document.getElementById('stage2');
const bala=document.getElementById('bala');
const pistola=document.getElementById('pistola');
const enemigo=document.getElementById('enemigo');
const stage2Continue=document.getElementById('stage2Continue');
let balaInPistola=false;
function showStage2(){ stage2.style.display='block'; window.scrollTo(0,0); }

bala.addEventListener('mousedown',()=>{}); // Se mantiene draggable con anterior
bala.addEventListener('touchmove', e=>{});
pistola.addEventListener('click',()=>{
    if(!balaInPistola) return;
    pistola.style.transition='transform 0.5s'; pistola.style.transform='rotate(360deg)';
    setTimeout(()=>{ pistola.style.transform='rotate(0deg)';
        if(Math.random()<0.875) disparoExitoso();
        else { alert('Mala suerte, la pistola no disparÃ³'); bala.style.display='block'; balaInPistola=false; }
    },500);
});
function disparoExitoso(){
    pistola.style.transition='transform 0.1s'; pistola.style.transform='rotate(-10deg)';
    setTimeout(()=>pistola.style.transform='rotate(0deg)',100);
    document.body.classList.add('shake'); setTimeout(()=>document.body.classList.remove('shake'),1000);
    const audio=new Audio('ARGHHH.mp3'); audio.play();
    enemigo.style.transition='opacity 1s'; enemigo.style.opacity=0;
    pistola.style.pointerEvents='none';
    setTimeout(()=>{ stage2Continue.style.transform='translateY(0)'; stage2Continue.style.opacity=1; stage2Continue.style.pointerEvents='auto'; },1000);
}
stage2Continue.onclick=()=>{ stage2.style.display='none'; showStage3(); };

// ETAPA 3
const stage3=document.getElementById('stage3');
const melvin=document.getElementById('melvin');
const playerPaddle=document.getElementById('playerPaddle');
const ball=document.getElementById('ball');
const stage3Continue=document.getElementById('stage3Continue');
let ballSpeedX=4, ballSpeedY=3;
function showStage3(){ stage3.style.display='block'; window.scrollTo(0,0); startGame3(); }

function startGame3(){
    let paddleY=playerPaddle.offsetTop;
    document.addEventListener('mousemove', e=>{
        paddleY=e.clientY-playerPaddle.offsetHeight/2;
        if(paddleY<0) paddleY=0;
        if(paddleY>stage3Area.offsetHeight-playerPaddle.offsetHeight) paddleY=stage3Area.offsetHeight-playerPaddle.offsetHeight;
        playerPaddle.style.top=paddleY+'px';
    });
    document.addEventListener('touchmove', e=>{
        let t=e.touches[0]; paddleY=t.clientY-playerPaddle.offsetHeight/2;
        if(paddleY<0) paddleY=0;
        if(paddleY>stage3Area.offsetHeight-playerPaddle.offsetHeight) paddleY=stage3Area.offsetHeight-playerPaddle.offsetHeight;
        playerPaddle.style.top=paddleY+'px';
    });

    function moveBall(){
        let ballX=ball.offsetLeft, ballY=ball.offsetTop;
        ballX+=ballSpeedX; ballY+=ballSpeedY;
        if(ballY<=0 || ballY>=stage3Area.offsetHeight-ball.offsetHeight) ballSpeedY*=-1;
        // ColisiÃ³n paddle derecho
        if(ballX+ball.offsetWidth>=playerPaddle.offsetLeft && ballY+ball.offsetHeight>=playerPaddle.offsetTop && ballY<=playerPaddle.offsetTop+playerPaddle.offsetHeight){ ballSpeedX*=-1; }
        // ColisiÃ³n Melvin (izquierda)
        if(ballX<=melvin.offsetWidth && ballY+ball.offsetHeight>=melvin.offsetTop && ballY<=melvin.offsetTop+melvin.offsetHeight){ ballSpeedX*=-1; }
        // Check fail
        if(ballX<=0) resetStage3();
        ball.style.left=ballX+'px'; ball.style.top=ballY+'px';
        if(stage3.style.display==='block') requestAnimationFrame(moveBall);
        if(ballX+ball.offsetWidth>=stage3Area.offsetWidth-10){ // Si llego al final lado derecho gana jugador
            // Sonido de victoria
            const audio=new Audio('ingaliator-1x1x1x1.mp3'); audio.play();
            melvin.style.filter='hue-rotate(0deg) saturate(10)'; melvin.style.transition='opacity 1s'; melvin.style.opacity=0;
            setTimeout(()=>{ stage3Continue.style.transform='translateY(0)'; stage3Continue.style.opacity=1; stage3Continue.style.pointerEvents='auto'; },1000);
        }
    }
    moveBall();
}

function resetStage3(){
    ball.style.left='50%'; ball.style.top='50%';
    startGame3();
}
</script>

</body>
</html>
