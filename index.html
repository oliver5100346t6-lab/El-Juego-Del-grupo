<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>El Juego del Grupo</title>
<style>
    body {
        background: white;
        margin: 0;
        font-family: Arial, sans-serif;
        text-align: center;
        user-select: none;
        overflow-x: hidden;
    }
    button {
        border: none;
        border-radius: 10px;
        transition: 0.2s;
    }
    #playButton {
        margin-top: 200px;
        padding: 20px 50px;
        font-size: 30px;
        background: #007bff;
        color: white;
        cursor: pointer;
    }
    #playButton:hover { background: #0056c7; }
    #gameArea, #stage2, #stage3 { display: none; margin-top: 40px; }

    .drag {
        width: 30vw; max-width: 150px;
        height: 30vw; max-height: 150px;
        border-radius: 10px;
        cursor: grab;
        position: relative;
        margin: 2vw;
        transition: transform 0.2s, opacity 0.2s;
    }
    .drag:active {
        transform: scale(1.1);
        opacity: 0.8;
        box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    }

    .dropzone {
        width: 32vw; max-width: 160px;
        height: 32vw; max-height: 160px;
        border: 3px dashed #888;
        border-radius: 10px;
        display: inline-block;
        margin: 2vw;
        background-size: cover;
        background-position: center;
    }
    #continueBtn, #stage2Continue, #stage3Continue {
        margin-top: 5vw;
        padding: 15px 40px;
        font-size: 20px;
        border-radius: 10px;
        opacity: 0.5;
        cursor: not-allowed;
        pointer-events: none;
    }
    #stage2Continue { background:#28a745; }
    #stage3Continue { background:#28a745; }

    .shake { animation: shake 0.3s; }
    @keyframes shake {
        0% { transform: translateX(0px); }
        25% { transform: translateX(-10px); }
        50% { transform: translateX(10px); }
        75% { transform: translateX(-10px); }
        100% { transform: translateX(0px); }
    }
    .fade { animation: fadeOut 0.6s forwards; }
    @keyframes fadeOut { to { opacity: 0; transform: scale(0.5); } }
    #stage2Continue, #stage3Continue { display: block; margin: 30px auto 0 auto; transform: translateY(50px); opacity:0; transition:all 0.5s; }
</style>
</head>
<body>

<button id="playButton">A JUGAR!</button>

<!-- ETAPA 1 -->
<div id="gameArea">
    <h2>Arrastra cada imagen a su pareja correcta</h2>
    <div id="dragContainer">
        <img src="Chatgpt111.png" class="drag" draggable="true" id="drag1">
        <img src="Foto de Yugerson XD.jpg" class="drag" draggable="true" id="drag2">
        <img src="IMG_20251028_160719132_BURST001.jpg" class="drag" draggable="true" id="drag3">
    </div>
    <div id="dropContainer">
        <div class="dropzone" id="drop1" data-match="drag2" style="background-image: url('Screenshot_20251029-231241_1.jpg');"></div>
        <div class="dropzone" id="drop2" data-match="drag3" style="background-image: url('a47c3705215f5bd024868af6ca9d4999.jpg');"></div>
        <div class="dropzone" id="drop3" data-match="drag1" style="background-image: url('chatgpt_22oct2025.png');"></div>
    </div>
    <button id="continueBtn">ðŸ”’ Continuar</button>
</div>

<!-- ETAPA 2 -->
<div id="stage2">
    <h2 style="color:black; font-family:Arial, sans-serif;">Ayuda a Chance a disparar su Pistola!</h2>
    <div id="stage2Images" style="display:flex; flex-wrap:wrap; justify-content:center; align-items:center; gap:20px; margin-top:20px;">
        <img src="Chance.png" id="chance" style="width:25vw; max-width:150px;">
        <img src="Pistola De Chance.png" id="pistola" style="width:20vw; max-width:120px; cursor:pointer; position:relative;">
        <img src="Bala De Chance .png" id="bala" style="width:10vw; max-width:60px; cursor:grab; position:relative;" draggable="true">
        <img src="1x1x1x1.png" id="enemigo" style="width:25vw; max-width:150px; position:relative;">
    </div>
    <button id="stage2Continue">Continuar</button>
</div>

<!-- ETAPA 3 -->
<div id="stage3">
    <div id="stage3Area" style="position:relative; height:60vh; width:90vw; margin:0 auto; background:#f0f0f0; overflow:hidden;">
        <div id="leftLine" style="position:absolute; left:0; top:0; width:5px; height:100%; background:blue;"></div>
        <div id="rightLine" style="position:absolute; right:0; top:0; width:5px; height:100%; background:blue;"></div>

        <img src="IMG_20251028_160719132_BURST001.jpg" id="melvin" style="position:absolute; left:0; top:50%; transform:translateY(-50%); width:10vw; max-width:100px;">
        <div id="playerPaddle" style="position:absolute; right:10px; top:50%; width:20px; height:15%; background:blue; transform:translateY(-50%);"></div>
        <div id="ball" style="position:absolute; width:20px; height:20px; border-radius:50%; background:blue; left:50%; top:50%; transform:translate(-50%, -50%);"></div>
    </div>
    <button id="stage3Continue" style="opacity:0; transform:translateY(50px); pointer-events:none;">Continuar</button>
</div>

<script>
// BOTON A JUGAR
const playButton = document.getElementById("playButton");
const gameArea = document.getElementById("gameArea");
playButton.onclick = () => { playButton.style.display = "none"; gameArea.style.display = "block"; };

// ETAPA 1 - DRAG & DROP CLÃSICO
let correct = 0;
document.querySelectorAll('.drag').forEach(drag => {
    drag.addEventListener('dragstart', e => e.dataTransfer.setData('id', drag.id));
});

document.querySelectorAll('.dropzone').forEach(zone => {
    zone.addEventListener('dragover', e => e.preventDefault());
    zone.addEventListener('drop', e => {
        const droppedId = e.dataTransfer.getData('id');
        handleDrop(zone, droppedId);
    });
});

function handleDrop(zone, droppedId){
    if(zone.dataset.match === droppedId){
        document.getElementById(droppedId).classList.add('fade');
        setTimeout(()=>document.getElementById(droppedId).style.display='none',600);
        zone.style.border = '3px solid #00cc44';
        correct++;
        if(correct===3){
            const btn=document.getElementById('continueBtn');
            btn.style.opacity=1; btn.style.cursor='pointer'; btn.style.pointerEvents='auto'; btn.innerHTML='Continuar âœ”';
        }
    } else {
        document.body.classList.add('shake');
        setTimeout(()=>document.body.classList.remove('shake'),300);
    }
}

document.getElementById('continueBtn').onclick=()=>{
    if(correct<3){ document.body.classList.add('shake'); setTimeout(()=>document.body.classList.remove('shake'),300); }
    else{ gameArea.style.display='none'; showStage2(); }
};

// ETAPA 2
const stage2 = document.getElementById('stage2');
const bala=document.getElementById('bala');
const pistola=document.getElementById('pistola');
const enemigo=document.getElementById('enemigo');
const stage2Continue=document.getElementById('stage2Continue');
let balaInPistola=false;
function showStage2(){ stage2.style.display='block'; window.scrollTo(0,0); }

// Drag & Drop para bala hacia pistola
bala.addEventListener('dragstart', e => e.dataTransfer.setData('id','bala'));
pistola.addEventListener('dragover', e => e.preventDefault());
pistola.addEventListener('drop', e => {
    const id = e.dataTransfer.getData('id');
    if(id==='bala'){
        bala.style.display='none';
        balaInPistola=true;
        alert('Bala lista para disparar!');
    }
});

// Disparo de pistola
pistola.addEventListener('click',()=>{
    if(!balaInPistola) return;
    pistola.style.transition='transform 0.5s'; pistola.style.transform='rotate(360deg)';
    setTimeout(()=>{
        pistola.style.transform='rotate(0deg)';
        if(Math.random()<0.875){ disparoExitoso(); }
        else { alert('Mala suerte, la pistola no disparÃ³'); bala.style.display='block'; balaInPistola=false; }
    },500);
});
function disparoExitoso(){
    pistola.style.transition='transform 0.1s'; pistola.style.transform='rotate(-10deg)';
    setTimeout(()=>pistola.style.transform='rotate(0deg)',100);
    document.body.classList.add('shake'); setTimeout(()=>document.body.classList.remove('shake'),1000);
    const audio=new Audio('ARGHHH.mp3'); audio.volume=0.5; audio.play();
    enemigo.style.transition='opacity 1s'; enemigo.style.opacity=0;
    pistola.style.pointerEvents='none';
    setTimeout(()=>{ stage2Continue.style.transform='translateY(0)'; stage2Continue.style.opacity=1; stage2Continue.style.pointerEvents='auto'; },1000);
}
stage2Continue.onclick=()=>{ stage2.style.display='none'; showStage3(); };

// ETAPA 3
const stage3Area=document.getElementById('stage3Area');
const stage3ContinueBtn=document.getElementById('stage3Continue');
const stage3Ball=document.getElementById('ball');
const stage3Melvin=document.getElementById('melvin');
const stage3Paddle=document.getElementById('playerPaddle');
let ballSpeedX=4, ballSpeedY=3, gameRunning=true;

function showStage3(){ document.getElementById('stage3').style.display='block'; window.scrollTo(0,0); startGame3(); }

function startGame3(){
    gameRunning=true;
    let ballPos={x:stage3Area.offsetWidth/2,y:stage3Area.offsetHeight/2};

    // Movimiento jugador
    function movePlayer(e){
        let y=e.touches? e.touches[0].clientY-stage3Area.getBoundingClientRect().top-stage3Paddle.offsetHeight/2 : e.clientY-stage3Area.getBoundingClientRect().top-stage3Paddle.offsetHeight/2;
        if(y<0)y=0; if(y>stage3Area.offsetHeight-stage3Paddle.offsetHeight)y=stage3Area.offsetHeight-stage3Paddle.offsetHeight;
        stage3Paddle.style.top=y+'px';
    }
    document.addEventListener('mousemove',movePlayer);
    document.addEventListener('touchmove',movePlayer);

    function moveBall(){
        if(!gameRunning)return;
        ballPos.x+=ballSpeedX; ballPos.y+=ballSpeedY;
        if(ballPos.y<=0||ballPos.y>=stage3Area.offsetHeight-stage3Ball.offsetHeight) ballSpeedY*=-1;

        // Rebote jugador
        if(ballPos.x+stage3Ball.offsetWidth>=stage3Paddle.offsetLeft &&
           ballPos.y+stage3Ball.offsetHeight>=parseFloat(stage3Paddle.style.top) &&
           ballPos.y<=parseFloat(stage3Paddle.style.top)+stage3Paddle.offsetHeight){
            ballSpeedX*=-1;
        }

        // Rebote Melvin
        if(ballPos.x<=stage3Melvin.offsetWidth &&
           ballPos.y+stage3Ball.offsetHeight>=parseFloat(stage3Melvin.style.top) &&
           ballPos.y<=parseFloat(stage3Melvin.style.top)+stage3Melvin.offsetHeight){
            ballSpeedX*=-1;
        }

        // Movimiento Melvin simple
        let melvinCenter=parseFloat(stage3Melvin.style.top)+stage3Melvin.offsetHeight/2;
        let ballCenter=ballPos.y+stage3Ball.offsetHeight/2;
        if(ballCenter>melvinCenter) stage3Melvin.style.top=Math.min(stage3Area.offsetHeight-stage3Melvin.offsetHeight, parseFloat(stage3Melvin.style.top)+2)+'px';
        if(ballCenter<melvinCenter) stage3Melvin.style.top=Math.max(0, parseFloat(stage3Melvin.style.top)-2)+'px';

        // Derrota
        if(ballPos.x<=0){ resetStage3(); return; }

        // Victoria
        if(ballPos.x+stage3Ball.offsetWidth>=stage3Area.offsetWidth){
            gameRunning=false;
            const audio=new Audio('ingaliator-1x1x1x1.mp3'); audio.volume=0.5; audio.play();
            stage3Melvin.style.filter='hue-rotate(0deg) saturate(10)';
            stage3Melvin.style.transition='opacity 1s'; stage3Melvin.style.opacity=0;
            setTimeout(()=>{ stage3ContinueBtn.style.transform='translateY(0)'; stage3ContinueBtn.style.opacity=1; stage3ContinueBtn.style.pointerEvents='auto'; },1000);
        }

        stage3Ball.style.left=ballPos.x+'px'; stage3Ball.style.top=ballPos.y+'px';
        requestAnimationFrame(moveBall);
    }
    moveBall();
}

function resetStage3(){
    ballPos={x:stage3Area.offsetWidth/2,y:stage3Area.offsetHeight/2};
    stage3Ball.style.left='50%'; stage3Ball.style.top='50%';
    stage3Melvin.style.top='50%';
}

stage3ContinueBtn.onclick=()=>{ stage3.style.display='none'; /* Cargar etapa 4 */ };
</script>

</body>
</html>
